<%=
  res = {}

  res["primary"] = link("http_endpoint").nodes.map do |node|
    {
      "name" => node.name,
      "id" => node.id,
      "index" => node.index,
      "address" => node.address,
    }
  end

  if p("http_proxy_with_requires.require_logs_in_template")
    link("logs_http_endpoint") # just call
  end

  if_link("logs_http_endpoint") do |link|
    res["logs"] = link.nodes.map do |node|
      {
        "name" => node.name,
        "id" => node.id,
        "index" => node.index,
        "address" => node.address,
      }
    end
  end

  JSON.dump(res)
%>
